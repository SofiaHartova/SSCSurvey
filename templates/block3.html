<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Физкультурные мероприятия</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="../static/block1.css">
</head>

<body>
    <div class="container my-4">
      <h2 class="mb-4">Физкультурные спортивные мероприятия</h2>
      <p>Укажите полное название мероприятия, количество обучающихся, принявших участие, и дату проведения мероприятия.</p>

      <form id="eventsForm" method="POST" action="/block3">
        <div id="eventFields">
          <div class="event-item row g-3 mb-3">
            <div class="col-md-6">
              <label for="eventName1" class="form-label">Название мероприятия</label>
              <input type="text" class="form-control" id="eventName1" placeholder="Введите название мероприятия" >
            </div>
            <div class="col-md-3">
              <label for="participants1" class="form-label">Количество участников</label>
              <input type="number" class="form-control" id="participants1" min="0" max="10000" placeholder="Количество участников" >
            </div>
            <button type="button" class="delete-button" onclick="deleteEvent(this)">×</button>

            <div class="col-md-3">
              <label for="eventDate1" class="form-label">Дата проведения</label>
              <input type="date" class="form-control" id="eventDate1" >
            </div>

          </div>
        </div>

        <button type="button" class="btn btn-success mb-3"  id="addEventBtn" onclick="addEventField()">Добавить мероприятие</button>

        <button type="submit" class="btn btn-secondary" name="action" id="backPageBtn" value="back">Назад</button>
        <button type="submit" class="btn btn-primary" name="action" id="submitFormBtn" value="submit">Отправить</button>
      </form>
    </div>

    <script>
      console.log(localStorage.getItem('events'))

      let eventCount = 0;
      function addEventField(name="", participants="", date="") {
        eventCount++;
        const eventFields = document.getElementById('eventFields');

        const eventItem = document.createElement('div');
        eventItem.classList.add('event-item', 'row', 'g-3', 'mb-3');
        eventItem.innerHTML = `
          <button type="button" class="delete-button" onclick="deleteEvent(this)">×</button>
          <div class="col-md-6">
            <label for="eventName${eventCount}" class="form-label">Название мероприятия</label>
            <input type="text" class="form-control" id="eventName${eventCount}" placeholder="Введите название мероприятия" required>
          </div>
          <div class="col-md-3">
            <label for="participants${eventCount}" class="form-label">Количество участников</label>
            <input type="number" class="form-control" id="participants${eventCount}" min="0" max="10000" placeholder="Количество участников" required>
          </div>
          <div class="col-md-3">
            <label for="eventDate${eventCount}" class="form-label">Дата проведения</label>
            <input type="date" class="form-control" id="eventDate${eventCount}" required>
          </div>
        `;

        eventFields.appendChild(eventItem);
      }
      function deleteEvent(button) {
        const eventItem = button.closest('.event-item');
        eventItem.remove();
      }

      function validateInputValue(input) {
            const value = input.value;

            if (/^0\d/.test(value)) {
                input.value = parseInt(value, 10);
            }
            if (value < 0 || value > 10000) {
                alert("Введите значение от 0 до 10000");
                input.value = "";
            }
        }
      document.querySelectorAll('input[type="number"][min="0"][max="10000"]').forEach(input => {
        input.addEventListener('input', () => validateInputValue(input));
      });
      function saveEvents(event) {

        const eventItems = document.querySelectorAll('.event-item');
        const events = [];

        eventItems.forEach((item, index) => {
          const name = item.querySelector(`#eventName${index + 1}`).value;
          const participants = item.querySelector(`#participants${index + 1}`).value;
          const date = item.querySelector(`#eventDate${index + 1}`).value;

          if (name && participants && date) {
            events.push({ name, participants: Number(participants), date });
          }
        });

        localStorage.setItem('events', JSON.stringify(events));
      }

      function loadEvents() {
        const savedEvents = JSON.parse(localStorage.getItem('events'));

        if (savedEvents) {
          savedEvents.forEach(event => {
            addEventField(event.name, event.participants, event.date);
          });
        } else {
          addEventField();
        }
      }

      document.getElementById('backPageBtn').addEventListener('click', saveEvents);
      document.getElementById('submitFormBtn').addEventListener('click', saveEvents);

      window.addEventListener('DOMContentLoaded', loadEvents);


    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
  </body>

</html>